[package]
name = "jolt-sdk"
version = "0.1.0"
authors = [
    "Michael Zhu <mzhu@a16z.com>",
    "Sam Ragsdale <sragsdale@a16z.com>",
    "Noah Citron <ncitron@a16z.com>",
    "Andrew Tretyakov <atretyakov@a16z.com>",
    "Markos Georghiades <mgeorghiades@a16z.com>",
]
description = "SDK for Jolt"
license = "MIT"
homepage = "https://github.com/a16z/jolt/README.md"
repository = "https://github.com/a16z/jolt"
edition = "2021"

[features]
default = ["jolt-platform/random"]

# Host/prover mode - runs on the host machine
host = [
    "jolt-core/default",
    "jolt-platform/std",
    "dep:tracer",
    "dep:common",
    "dep:ark-ec",
    "dep:ark-bn254",
    "postcard/use-std",
    "serde/std",
]

# Guest std mode - full std support with all capabilities
# ZeroOS features are enabled via zeroos-jolt-platform/std which pulls in arch-riscv,
# os-linux, runtime-musl, etc.
guest-std = [
    "postcard/use-std",
    "jolt-platform/std",
    "jolt-sdk-macros/guest-std",
    "serde/std",
    "zeroos-jolt-platform/std",
]

# Guest verifier mode
guest-verifier = [
    "guest-std",
    "dep:tracer",
    "dep:common",
    "dep:ark-bn254",
    "jolt-core/minimal",
]

malloc-shim = ["jolt-platform/malloc-shim"]

# =============================================================================
# ZeroOS pass-through features (for RISC-V guest builds only)
# These are for advanced users who want fine-grained control.
# For most users, the zeroos dependency already has the right features enabled.
# =============================================================================

# Architecture - provides _start, ARCH_OPS, weak _trap_handler and weak __main_entry
# jolt-sdk provides its own _trap_handler (ECALL convention) and __main_entry
arch-riscv = ["zeroos/arch-riscv"]

# Debug and diagnostics
debug = ["zeroos/debug"]
bounds-checks = ["zeroos/bounds-checks"]

# OS layer
os-linux = ["zeroos/os-linux"]

# Runtime (with bootstrap - provides __runtime_bootstrap, _init, _fini)
# Note: We don't enable libc-main since jolt-sdk provides its own __main_entry
# that calls the macro-generated main() with no args.
runtime-musl = ["zeroos/runtime-musl-bootstrap"]

# Memory/allocator
memory = ["zeroos/alloc-linked-list"]

# VFS (virtual filesystem)
vfs = ["zeroos/vfs"]
vfs-device-console = ["vfs", "zeroos/vfs-device-console"]

# Threading/scheduler
thread = ["zeroos/scheduler-cooperative"]

# Random number generation
random = ["zeroos/rng-lcg"]

[dependencies]
# Jolt's jolt-platform for host/prover functionality
jolt-platform.workspace = true
postcard.workspace = true
serde = { version = "1.0", default-features = false, features = ["derive"] }
ark-ec = { workspace = true, default-features = false, optional = true }
ark-bn254 = { workspace = true, default-features = false, optional = true }

jolt-sdk-macros.workspace = true
# Host-only dependencies
common = { workspace = true, optional = true }
jolt-core = { workspace = true, default-features = false, optional = true }
tracer = { workspace = true, optional = true }
rand = { workspace = true, optional = true }

# Guest dependencies (from ZeroOS) - RISC-V linux target (std mode)
[target.'cfg(all(target_os = "linux", target_arch = "riscv64"))'.dependencies]
# ZeroOS unified crate for std builds.
# No arch-riscv here - for std builds, zeroos-jolt-platform/std enables the full boot infrastructure.
zeroos = { path = "../../ZeroOS/crates/zeroos", default-features = false, features = [
    "alloc-linked-list",
] }
# ZeroOS jolt-platform: provides __platform_bootstrap, #[global_allocator], #[panic_handler]
zeroos-jolt-platform = { package = "jolt-platform", path = "../../ZeroOS/platforms/jolt-platform", default-features = false, features = ["memory", "std"] }

# Guest dependencies (from ZeroOS) - RISC-V bare metal target (no-std mode)
[target.'cfg(all(target_os = "none", target_arch = "riscv64"))'.dependencies]
# ZeroOS unified crate for no-std builds.
# arch-riscv provides _start from ZeroOS
zeroos = { path = "../../ZeroOS/crates/zeroos", default-features = false, features = ["arch-riscv", "memory"]}
# ZeroOS jolt-platform: provides __platform_bootstrap, #[global_allocator], #[panic_handler]
zeroos-jolt-platform = { package = "jolt-platform", path = "../../ZeroOS/platforms/jolt-platform", default-features = false, features = ["memory"] }

[dev-dependencies]
hex-literal.workspace = true
